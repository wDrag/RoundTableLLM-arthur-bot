Plan v2.0 — Orchestration JSON enforcement & recovery

Goal
Make master orchestration succeed by enforcing strict JSON plan/synthesis outputs, capturing raw plan outputs for debugging, and re-running orchestration tests to reach confidence ≥ 0.8.

Scope
- Implement JSON enforcement and logging for master plan/synthesis.
- Add minimal JSON repair/extraction before validation.
- Re-run orchestration tests with real credentials from .env.

Steps
1) Add raw master plan capture (redacted) before schema validation to identify mismatch.
2) Enforce JSON-only output for master plan/synthesis (stronger system prompt + jsonMode support in provider call).
3) Add JSON repair/extraction (first JSON object) prior to validation.
4) If still failing, add minimal schema relaxations + defaults for optional fields.
5) Re-run /api/chat orchestration and confirm 200 response with valid plan/synthesis.

Acceptance criteria
- Master plan validates against OrchestrationPlan schema.
- /api/chat returns 200 with reply + meta (and audit for audit/deep).
- No DISCARD outputs referenced in synthesis.

Execution time estimate
- Unit: minutes
- Per-step:
   - Step 1: O=15, M=25, P=40, E=26.7
   - Step 2: O=20, M=35, P=55, E=35.0
   - Step 3: O=10, M=20, P=35, E=20.8
   - Step 4: O=10, M=15, P=30, E=16.7
   - Step 5: O=15, M=25, P=40, E=26.7
- Total: O_total=70, M_total=120, P_total=200, E_total=126.0
- Assumptions:
   - .env has valid Anthropic credentials and gateway is reachable.
   - Master model responds within timeout.
- Risks that push to P:
   - Master ignores JSON-only instructions.
   - Additional schema changes needed after seeing raw output.
- Confidence in estimate: 0.62

Questions to raise confidence to ≥ 0.8
1) Can we log raw master plan outputs (redacted) to report.local for debugging? (Yes, report.local only)
2) Should we enable provider-level JSON mode (if supported by gateway) for master outputs? (Yes)
3) Are minimal schema relaxations acceptable if model outputs include extra keys? (Yes)

Confidence
- 0.84
